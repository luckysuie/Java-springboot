pipeline {
    agent any
    stages {
        stage('git checkout') {
            steps {
                echo 'Checking out source code from Git repository...'
                git branch: 'main', url: 'https://github.com/luckysuie/Java-springboot.git'
            }
        }
        stage('checks CI pipeline status') {
            steps {
                echo 'CI pipeline is working fine...'
                steps {
                    script {
                        def buildStatus = currentBuild.currentResult
                        if (buildStatus == 'SUCCESS') {
                            echo "Build succeeded! continuing to CD pipeline..."
                        } else {
                            error "Build failed with status: ${buildStatus}"
                        }
                    }
                }
            }
        }
        stage('Deploy to aks with argocd') {
            steps {
                echo 'Deploying the application to AKS using ArgoCD...'
                sh '''
                    argocd login luckyargocd.azurewebsites.net --username admin --password Y8eYxzixlLgZKSG6 --insecure
                    argocd app sync onepiece-app
                '''
            }
        }
    }
}